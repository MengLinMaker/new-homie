{
    "annotations": {
        "list": [
            {
                "builtIn": 1,
                "datasource": { "type": "grafana", "uid": "-- Grafana --" },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
            }
        ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "links": [],
    "panels": [
        {
            "collapsed": false,
            "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
            "id": 10,
            "panels": [],
            "title": "Infra",
            "type": "row"
        },
        {
            "datasource": { "uid": "tempo" },
            "fieldConfig": {
                "defaults": {
                    "color": { "mode": "palette-classic" },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.1,
                        "drawStyle": "bars",
                        "fillOpacity": 100,
                        "gradientMode": "hue",
                        "hideFrom": { "legend": false, "tooltip": false, "viz": false },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 0,
                        "pointSize": 5,
                        "scaleDistribution": { "type": "linear" },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": { "group": "A", "mode": "none" },
                        "thresholdsStyle": { "mode": "off" }
                    },
                    "mappings": [],
                    "thresholds": { "mode": "absolute", "steps": [{ "color": "green" }] }
                },
                "overrides": []
            },
            "gridPos": { "h": 7, "w": 24, "x": 0, "y": 1 },
            "id": 11,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "hidden",
                    "placement": "right",
                    "showLegend": false
                },
                "tooltip": { "hideZeros": false, "mode": "multi", "sort": "none" }
            },
            "pluginVersion": "12.0.2",
            "targets": [
                {
                    "filters": [
                        { "id": "9115303b", "operator": "=", "scope": "span" },
                        {
                            "id": "service-name",
                            "operator": "=",
                            "scope": "resource",
                            "tag": "service.name",
                            "value": ["function-scrape_locality"]
                        },
                        {
                            "id": "span-name",
                            "operator": "=",
                            "scope": "span",
                            "tag": "name",
                            "value": ["handler"]
                        },
                        {
                            "id": "status",
                            "operator": "=",
                            "scope": "intrinsic",
                            "tag": "status",
                            "value": "ok",
                            "valueType": "keyword"
                        }
                    ],
                    "hide": true,
                    "limit": 20,
                    "metricsQueryType": "range",
                    "queryType": "traceqlSearch",
                    "refId": "ok",
                    "tableType": "traces"
                },
                {
                    "datasource": { "type": "tempo", "uid": "tempo" },
                    "filters": [
                        { "id": "9115303b", "operator": "=", "scope": "span" },
                        {
                            "id": "service-name",
                            "operator": "=",
                            "scope": "resource",
                            "tag": "service.name",
                            "value": ["function-scrape_locality"]
                        },
                        {
                            "id": "span-name",
                            "operator": "=",
                            "scope": "span",
                            "tag": "name",
                            "value": ["handler"]
                        },
                        {
                            "id": "status",
                            "operator": "=",
                            "scope": "intrinsic",
                            "tag": "status",
                            "value": "error",
                            "valueType": "keyword"
                        }
                    ],
                    "hide": true,
                    "limit": 20,
                    "metricsQueryType": "range",
                    "queryType": "traceqlSearch",
                    "refId": "error",
                    "tableType": "traces"
                },
                {
                    "datasource": { "type": "tempo", "uid": "tempo" },
                    "filters": [
                        { "id": "9115303b", "operator": "=", "scope": "span" },
                        {
                            "id": "service-name",
                            "operator": "=",
                            "scope": "resource",
                            "tag": "service.name",
                            "value": ["function-scrape_locality"]
                        },
                        {
                            "id": "span-name",
                            "operator": "=",
                            "scope": "span",
                            "tag": "name",
                            "value": ["handler"]
                        },
                        {
                            "id": "status",
                            "operator": "=",
                            "scope": "intrinsic",
                            "tag": "status",
                            "value": "unset",
                            "valueType": "keyword"
                        }
                    ],
                    "hide": false,
                    "limit": 20,
                    "metricsQueryType": "range",
                    "queryType": "traceqlSearch",
                    "refId": "unset",
                    "tableType": "traces"
                }
            ],
            "title": "function-scrape_locality duration",
            "transparent": true,
            "type": "timeseries"
        },
        {
            "collapsed": false,
            "gridPos": { "h": 1, "w": 24, "x": 0, "y": 8 },
            "id": 4,
            "panels": [],
            "title": "Logs",
            "type": "row"
        },
        {
            "datasource": { "uid": "loki" },
            "fieldConfig": {
                "defaults": {
                    "custom": {
                        "hideFrom": { "legend": false, "tooltip": false, "viz": false },
                        "scaleDistribution": { "type": "linear" }
                    }
                },
                "overrides": []
            },
            "gridPos": { "h": 4, "w": 24, "x": 0, "y": 9 },
            "id": 5,
            "options": {
                "calculate": false,
                "calculation": {
                    "xBuckets": { "mode": "size", "value": "" },
                    "yBuckets": { "mode": "size", "scale": { "type": "linear" }, "value": "" }
                },
                "cellGap": 0,
                "color": {
                    "exponent": 2,
                    "fill": "orange",
                    "min": 0,
                    "mode": "opacity",
                    "reverse": false,
                    "scale": "linear",
                    "scheme": "RdYlBu",
                    "steps": 128
                },
                "exemplars": { "color": "rgba(255,0,255,0.7)" },
                "filterValues": { "le": 1e-9 },
                "legend": { "show": false },
                "rowsFrame": { "layout": "unknown" },
                "tooltip": { "mode": "multi", "showColorScale": false, "yHistogram": false },
                "yAxis": { "axisPlacement": "hidden", "reverse": false }
            },
            "pluginVersion": "12.0.2",
            "targets": [
                {
                    "direction": "backward",
                    "editorMode": "builder",
                    "expr": "count by(detected_level) (count_over_time({service_namespace=\"NewHomie\", service_name=\"function-scrape_locality\"} | code_function_name != `` | detected_level =~ `(fatal|error|warn)` [$__auto]))",
                    "hide": true,
                    "legendFormat": "",
                    "queryType": "range",
                    "refId": "Source",
                    "step": "1m"
                },
                {
                    "datasource": { "name": "Expression", "type": "__expr__", "uid": "__expr__" },
                    "downsampler": "sum",
                    "expression": "Source",
                    "hide": false,
                    "refId": "detected_level",
                    "type": "resample",
                    "upsampler": "fillna",
                    "window": "$heatmap_interval"
                }
            ],
            "title": "detected_level heatmap",
            "transformations": [
                { "id": "joinByField", "options": { "byField": "Time", "mode": "outer" } },
                {
                    "filter": { "id": "byRefId", "options": "" },
                    "id": "organize",
                    "options": {
                        "excludeByName": {
                            "Time": false,
                            "{detected_level=\"error\"}": true,
                            "{detected_level=\"fatal\"}": true,
                            "{detected_level=\"warn\"}": true
                        },
                        "includeByName": {},
                        "indexByName": {
                            "Time": 0,
                            "detected_level error": 2,
                            "detected_level fatal": 3,
                            "detected_level warn": 1
                        },
                        "renameByName": {
                            "Data error": "",
                            "Data fatal": "",
                            "Data warn": "",
                            "ERROR": "",
                            "TRACE": "",
                            "Time": "",
                            "{detected_level=\"debug\"}": "DEBUG",
                            "{detected_level=\"error\"}": "ERROR",
                            "{detected_level=\"fatal\"}": "FATAL",
                            "{detected_level=\"info\"}": "INFO",
                            "{detected_level=\"trace\"}": "TRACE",
                            "{detected_level=\"warn\"}": "WARN"
                        }
                    }
                }
            ],
            "transparent": true,
            "type": "heatmap"
        },
        {
            "datasource": { "uid": "loki" },
            "fieldConfig": {
                "defaults": {
                    "custom": {
                        "hideFrom": { "legend": false, "tooltip": false, "viz": false },
                        "scaleDistribution": { "type": "linear" }
                    }
                },
                "overrides": []
            },
            "gridPos": { "h": 5, "w": 24, "x": 0, "y": 13 },
            "id": 9,
            "options": {
                "calculate": false,
                "calculation": {
                    "xBuckets": { "mode": "size", "value": "" },
                    "yBuckets": { "mode": "size", "scale": { "type": "linear" }, "value": "" }
                },
                "cellGap": 0,
                "color": {
                    "exponent": 2,
                    "fill": "orange",
                    "min": 0,
                    "mode": "opacity",
                    "reverse": false,
                    "scale": "linear",
                    "scheme": "RdYlBu",
                    "steps": 128
                },
                "exemplars": { "color": "rgba(255,0,255,0.7)" },
                "filterValues": { "le": 1e-9 },
                "legend": { "show": false },
                "rowsFrame": { "layout": "unknown" },
                "tooltip": { "mode": "multi", "showColorScale": false, "yHistogram": false },
                "yAxis": { "axisPlacement": "hidden", "reverse": false }
            },
            "pluginVersion": "12.0.2",
            "targets": [
                {
                    "direction": "backward",
                    "editorMode": "code",
                    "expr": "count by(code_function_name) (count_over_time({service_namespace=\"NewHomie\", service_name=\"function-scrape_locality\"} | code_function_name != `` | detected_level =~ `(fatal|error|warn)` [$__auto]))",
                    "hide": true,
                    "legendFormat": "",
                    "queryType": "range",
                    "refId": "Source",
                    "step": "1m"
                },
                {
                    "datasource": { "name": "Expression", "type": "__expr__", "uid": "__expr__" },
                    "downsampler": "sum",
                    "expression": "Source",
                    "hide": false,
                    "refId": "code_function_name",
                    "type": "resample",
                    "upsampler": "fillna",
                    "window": "$heatmap_interval"
                }
            ],
            "title": "code_function_name heatmap",
            "transformations": [
                { "id": "joinByField", "options": { "byField": "Time", "mode": "outer" } },
                {
                    "id": "organize",
                    "options": {
                        "excludeByName": {
                            "Time": false,
                            "{code_function_name=\"BrowserService.Error\"}": true,
                            "{code_function_name=\"BrowserService.getHTML\"}": true,
                            "{code_function_name=\"DomainListingsService.tryExtractListings\"}": true,
                            "{code_function_name=\"DomainListingsService.tryTransformSalePrice\"}": true,
                            "{code_function_name=\"DomainSuburbService.tryExtractProfile\"}": true,
                            "{detected_level=\"error\"}": true,
                            "{detected_level=\"fatal\"}": true,
                            "{detected_level=\"warn\"}": true
                        },
                        "includeByName": {},
                        "indexByName": {
                            "Data error": 2,
                            "Data fatal": 3,
                            "Data warn": 1,
                            "Time": 0,
                            "{detected_level=\"error\"}": 5,
                            "{detected_level=\"fatal\"}": 6,
                            "{detected_level=\"warn\"}": 4
                        },
                        "renameByName": {
                            "Data error": "ERROR",
                            "Data fatal": "FATAL",
                            "Data warn": "WARN",
                            "ERROR": "",
                            "TRACE": "",
                            "Time": "",
                            "{detected_level=\"debug\"}": "DEBUG",
                            "{detected_level=\"error\"}": "ERROR",
                            "{detected_level=\"fatal\"}": "FATAL",
                            "{detected_level=\"info\"}": "INFO",
                            "{detected_level=\"trace\"}": "TRACE",
                            "{detected_level=\"warn\"}": "WARN"
                        }
                    }
                }
            ],
            "transparent": true,
            "type": "heatmap"
        },
        {
            "datasource": { "uid": "loki" },
            "fieldConfig": {
                "defaults": {
                    "custom": {
                        "align": "auto",
                        "cellOptions": { "type": "auto", "wrapText": false },
                        "filterable": true,
                        "inspect": true
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [{ "color": "green" }, { "color": "red", "value": 80 }]
                    }
                },
                "overrides": [
                    {
                        "matcher": { "id": "byName", "options": "Line" },
                        "properties": [{ "id": "custom.width", "value": 426 }]
                    },
                    {
                        "matcher": { "id": "byName", "options": "trace_id" },
                        "properties": [{ "id": "custom.width", "value": 94 }]
                    },
                    {
                        "matcher": { "id": "byName", "options": "labels" },
                        "properties": [{ "id": "custom.width", "value": 80 }]
                    },
                    {
                        "matcher": { "id": "byName", "options": "code_function_name" },
                        "properties": [{ "id": "custom.width", "value": 364 }]
                    },
                    {
                        "matcher": { "id": "byName", "options": "code_function_args" },
                        "properties": [{ "id": "custom.width", "value": 168 }]
                    }
                ]
            },
            "gridPos": { "h": 15, "w": 24, "x": 0, "y": 18 },
            "id": 1,
            "options": {
                "cellHeight": "sm",
                "footer": {
                    "countRows": false,
                    "enablePagination": true,
                    "fields": "",
                    "reducer": ["sum"],
                    "show": false
                },
                "showHeader": true,
                "sortBy": []
            },
            "pluginVersion": "12.0.2",
            "targets": [
                {
                    "direction": "backward",
                    "editorMode": "builder",
                    "expr": "{service_namespace=\"NewHomie\", service_name=\"function-scrape_locality\"} | detected_level =~ `${log_level}`",
                    "queryType": "range",
                    "refId": "A"
                }
            ],
            "title": "detected_level exception logs",
            "transformations": [
                {
                    "id": "organize",
                    "options": {
                        "excludeByName": {
                            "Line": true,
                            "Time": true,
                            "id": true,
                            "labelTypes": true,
                            "trace_id": false,
                            "tsNs": true
                        },
                        "includeByName": {},
                        "indexByName": {
                            "Line": 4,
                            "Time": 2,
                            "id": 6,
                            "labelTypes": 3,
                            "labels": 1,
                            "trace_id": 0,
                            "tsNs": 5
                        },
                        "renameByName": {}
                    }
                },
                {
                    "id": "extractFields",
                    "options": {
                        "delimiter": ",",
                        "format": "kvp",
                        "jsonPaths": [{ "path": "object.args" }],
                        "keepTime": false,
                        "regExp": "/(args_page)/",
                        "replace": false,
                        "source": "labels"
                    }
                },
                {
                    "id": "organize",
                    "options": {
                        "excludeByName": {
                            "detected_level": true,
                            "exception_stacktrace": true,
                            "exception_type": true,
                            "host_arch": true,
                            "host_id": true,
                            "host_name": true,
                            "labels": false,
                            "observed_timestamp": true,
                            "os_type": true,
                            "os_version": true,
                            "process_command": true,
                            "process_command_args": true,
                            "process_executable_name": true,
                            "process_executable_path": true,
                            "process_owner": true,
                            "process_pid": true,
                            "process_runtime_description": true,
                            "process_runtime_name": true,
                            "process_runtime_version": true,
                            "scope_name": true,
                            "scope_version": true,
                            "service_name": true,
                            "service_namespace": true,
                            "service_version": true,
                            "severity_number": true,
                            "severity_text": true
                        },
                        "includeByName": {},
                        "indexByName": {
                            "code_function_args": 2,
                            "code_function_name": 1,
                            "detected_level": 5,
                            "exception_message": 4,
                            "exception_stacktrace": 28,
                            "exception_type": 29,
                            "host_arch": 6,
                            "host_id": 7,
                            "host_name": 8,
                            "labels": 3,
                            "observed_timestamp": 9,
                            "os_type": 10,
                            "os_version": 11,
                            "process_command": 12,
                            "process_command_args": 13,
                            "process_executable_name": 14,
                            "process_executable_path": 15,
                            "process_owner": 16,
                            "process_pid": 17,
                            "process_runtime_description": 18,
                            "process_runtime_name": 19,
                            "process_runtime_version": 20,
                            "scope_name": 21,
                            "scope_version": 22,
                            "service_name": 23,
                            "service_namespace": 24,
                            "service_version": 25,
                            "severity_number": 26,
                            "severity_text": 27,
                            "trace_id": 0
                        },
                        "renameByName": {}
                    }
                }
            ],
            "transparent": true,
            "type": "table"
        }
    ],
    "preload": false,
    "schemaVersion": 41,
    "tags": [],
    "templating": {
        "list": [
            {
                "auto": false,
                "auto_count": 30,
                "auto_min": "10s",
                "current": { "text": "1s", "value": "1s" },
                "description": "",
                "name": "heatmap_interval",
                "options": [
                    { "selected": true, "text": "1s", "value": "1s" },
                    { "selected": false, "text": "2s", "value": "2s" },
                    { "selected": false, "text": "5s", "value": "5s" },
                    { "selected": false, "text": "10s", "value": "10s" },
                    { "selected": false, "text": "20s", "value": "20s" },
                    { "selected": false, "text": "30s", "value": "30s" },
                    { "selected": false, "text": "1m", "value": "1m" },
                    { "selected": false, "text": "2m", "value": "2m" },
                    { "selected": false, "text": "5m", "value": "5m" },
                    { "selected": false, "text": "10m", "value": "10m" },
                    { "selected": false, "text": "15m", "value": "15m" },
                    { "selected": false, "text": "20m", "value": "20m" }
                ],
                "query": "1s,2s,5s,10s,20s,30s,1m,2m,5m,10m,15m,20m",
                "refresh": 2,
                "type": "interval"
            },
            {
                "current": { "text": "$__all", "value": "$__all" },
                "description": "",
                "includeAll": true,
                "name": "log_level",
                "options": [
                    { "selected": false, "text": "fatal", "value": "fatal" },
                    { "selected": false, "text": "error", "value": "error" },
                    { "selected": false, "text": "warn", "value": "warn" },
                    { "selected": false, "text": "info", "value": "info" },
                    { "selected": false, "text": "debug", "value": "debug" },
                    { "selected": false, "text": "trace", "value": "trace" }
                ],
                "query": "fatal,error,warn,info,debug,trace",
                "type": "custom"
            }
        ]
    },
    "time": { "from": "now-6h", "to": "now" },
    "timepicker": {},
    "timezone": "browser",
    "title": "stack-service_scrape_pipeline",
    "uid": "c7106517-a852-446a-aa7b-800c8a522bc0",
    "version": 35
}
